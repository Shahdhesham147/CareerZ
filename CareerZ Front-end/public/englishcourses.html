<!DOCTYPE html>
<html lang="en">
<head>

         <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Css links -->
    <link rel="stylesheet" href="../src/css/all.min.css">
    <link rel="stylesheet" href="../src/css/bootstrap.min.css">
    <link rel="stylesheet" href="../src/css/courses.css"> 

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Courses</title>

</head>
<body>
<!-- nav bar -->
<nav class="navbar back-default navbar-expand-md fixed-top pb-0" id="navbar">
    <div class="container-fluid mx-5">
      
      <a class="navbar-brand" href="#">
        <img src="../src/img/New logo 1.png" alt="" class="logo">
      </a>
    
      <button class="navbar-toggler " type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fa-solid fa-bars fa-lg d-flex justify-content-center align-items-center my-3"></i>
      </button>

      <div class="collapse navbar-collapse justify-content-end" id="navbarNavDropdown">
        <ul class="navbar-nav">
      
          <li class="nav-item p-3"><a class="nav-link active" href="index.html">Home</a></li>
          <li class="nav-item p-3"><a class="nav-link" href="englishcourses.html">Courses</a></li>
          <li class="nav-item p-3"><a class="nav-link" href="internship.html">Internship</a></li>
          <li class="nav-item p-3"><a class="nav-link" href="#">About Us</a></li>
          <li class="nav-item p-3"><a class="nav-link" href="#">Contact</a></li>
       
        </ul>
        
        <form class="d-flex">
<div class="dropdown">
  <i class="fa-solid fa-circle-user Icon m-3 mx-5 dropdown-toggle" 
     id="userMenu" 
     data-bs-toggle="dropdown" 
     aria-expanded="false"
     style="font-size: 30px; cursor: pointer;"></i>

  <ul class="dropdown-menu" aria-labelledby="userMenu">
 <li><a class="dropdown-item" href="profile.html">Profile</a></li>
    <li><a class="dropdown-item" href="All SignUp.html"> sign up</a></li>
    <li><a class="dropdown-item" href="All login.html">login</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="#">log out</a></li>
  </ul>
</div>

          <button id="Btn" type="button">Arabic</button>

        </form>
        
      </div>
    </div>    

  </nav>
<div class="All">
<!-- header -->
 <section class="header">
  <img src="../src/img/bg.png" alt="bg" class="bgimg">
<div class="text">
      <h1>Explore Learning Paths</h1>
      <div class="srchbar">
        <input type="text" placeholder="Search for a course or subject" id="searchInput">
        <button class="srch" id="searcBtn"><i class="fa-solid fa-magnifying-glass"></i></button>
      </div>
</div>
 </section>
 <!-- categories  -->
<section class="filter">
  <div class="categories">
    <ul>
      <li class="all">All</li>
      <li class="filtersort" onclick="Sidebar()">
        <i class="fa-solid fa-sliders fa-sm"></i>
      Filter & Sort</li>
    </ul>
  </div>
</section>
<!-- filter  -->
<div class="sidebar" id="sidebar">
    <h3>Filter</h3>
    <div class="filter-group">
      <strong>Price:</strong>
      <label><input type="checkbox" name="price" value="0-20"> $0 - $250</label>
      <label><input type="checkbox" name="price" value="21-30"> $250 - $500</label>
      <label><input type="checkbox" name="price" value="31-50"> $500 - $1000</label>
    </div>

    <div class="filter-group">
      <strong>Category:</strong>
      <label><input type="checkbox" name="category" value="Web"> Web</label>
      <label><input type="checkbox" name="category" value="Design"> Design</label>
      <label><input type="checkbox" name="category" value="Business"> Business</label>
      <label><input type="checkbox" name="category" value="Data"> Data</label>
      <label><input type="checkbox" name="category" value="Programming"> Programming</label>
    </div>

    <h3>Sort</h3>
    <div class="filter-group">
      <label><input type="radio" name="sort" value="price-asc"> Price: Low → High</label>
      <label><input type="radio" name="sort" value="price-desc"> Price: High → Low</label>
      <label><input type="radio" name="sort" value="name-asc"> Name: A → Z</label>
      <label><input type="radio" name="sort" value="name-desc"> Name: Z → A</label>
    </div>
      <button class="addfilter" onclick="Sidebar()">Add filters</button>
      <br>
      <button class="closebtn" onclick="Sidebar()">Close</button>
  </div>
<!-- Courses Section -->
<section class="courses" id="coursesContainer">
  <div class="card" onclick="window.location.href='course_dtaits.html'">
      <img src="../src/img/img1.png" alt="UI/UX Design">
      <h3>UI/UX Design</h3>
      <p>Beginner</p>
      <div class="details">
        <span class="rate"><i class="fa-solid fa-star"></i> 4.7</span>
        <span class="hrs">70 total hours</span>
        <span class="price">Free</span>
      </div>
  </div>

  <!-- <div class="card" onclick="window.location.href='course_dtaits.html'">
      <img src="../src/img/img2.png" alt="Graphic Design">
      <h3>Graphic Design</h3>
      <p>Beginner</p>
      <div class="details">
        <span class="rate"><i class="fa-solid fa-star"></i> 4.6</span>
        <span class="hrs">120 total hours</span>
        <span class="price">Free</span>
      </div>
  </div> -->

  <!-- <div class="card" onclick="window.location.href='course_dtaits.html'">
      <img src="../src/img/img3.png" alt="Python Programming">
      <h3>Python Programming</h3>
      <p>Beginner</p>
      <div class="details">
        <span class="rate"><i class="fa-solid fa-star"></i> 4.8</span>
        <span class="hrs">130 total hours</span>
        <span class="price">500 LE</span>
      </div>
  </div> -->

  <!-- <div class="card" onclick="window.location.href='course_dtaits.html'">
      <img src="../src/img/img4.png" alt="Digital Marketing">
      <h3>Digital Marketing</h3>
      <p>Beginner</p>
      <div class="details">
        <span class="rate"><i class="fa-solid fa-star"></i> 4.6</span>
        <span class="hrs">90 total hours</span>
        <span class="price">100 LE</span>
      </div>
  </div> -->
<!-- 
  <div class="card" onclick="window.location.href='course_dtaits.html'">
      <img src="../src/img/img5.png" alt="Full-stack Web Developer">
      <h3>Full-stack Web Developer</h3>
      <p>Beginner</p>
      <div class="details">
        <span class="rate"><i class="fa-solid fa-star"></i> 4.9</span>
        <span class="hrs">120 total hours</span>
        <span class="price">500 LE</span>
      </div>
  </div> -->

  <!-- <div class="card" onclick="window.location.href='course_dtaits.html'">
      <img src="../src/img/img6.png" alt="Data Science">
      <h3>Data science</h3>
      <p>Beginner</p>
    <div class="details">
      <span class="rate"><i class="fa-solid fa-star"></i> 4.7</span>
      <span class="hrs">60 total hours</span>
     <span class="price">Free</span>
    </div>
  </div> -->
</section>
</div>
<!-- javascript -->
<script>
  function Sidebar() {
   const popCont = document.getElementById("sidebar");
          popCont.style.visibility =
              popCont.style.visibility ===
                  "visible"
                  ? "hidden"
                  : "visible"; }
</script>


<script>

  const token = localStorage.getItem("token");
  if (!token) {
    window.location.href = "./login.html";
  }

  // Handle unauthorized response
  function handleUnauthorized() {
    localStorage.removeItem("token"); // clear invalid token
    alert("Your session has expired. Please log in again.");
    window.location.href = "./login.html";
  }
  
  const btn = document.getElementById("Btn");
  btn.addEventListener("click", function () {
    if (btn.textContent === "Arabic") {
      btn.textContent = "EN"; 
       window.location.href = "arabiccourses.html";
    } else {
      btn.textContent = "Arabic";
   window.location.href = "englishcourses.html";

    }
  });
// Fetch all courses
  async function fetchCourses() {
    try {
      const res = await fetch("http://localhost:8888/courses", {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + token
        }
      });

      if (res.status === 401) {
        handleUnauthorized();
        return;
      }
      if (res.ok) {
        const courses = await res.json();
        renderCourses(courses);
      } else {
        alert("Failed to fetch courses");
      }
    } catch (error) {
      console.error(error);
      alert("Error loading courses. Please try again later.");
    }
  }

  // Search courses by keyword
  async function searchCourses(keyword) {
    try {
      const res = await fetch(`http://localhost:8888/search?keyword=${encodeURIComponent(keyword)}`, {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + token
        }
      });

      if (res.status === 401) {
        handleUnauthorized();
        return;
      }
      
      if (res.ok) {
        const courses = await res.json();
        renderCourses(courses, true);
      } else {
        alert("Failed to search courses");
      }
    } catch (error) {
      console.error(error);
      alert("Error searching courses. Please try again later.");
    }
  }

  // Reusable function to render courses
  function renderCourses(courses, isSearch = false) {
    const container = document.getElementById("coursesContainer");
    container.innerHTML = "";

    if (!courses || courses.length === 0) {
      container.innerHTML = `<p>${isSearch ? "No courses found" : "No courses available"}</p>`;
      return;
    }

    courses.forEach(course => {
      const card = document.createElement("div");
      card.className = "card";
      card.onclick = () => window.location.href = `./course_dtaits.html?id=${course.course_id}`;

      card.innerHTML = `
        <img src="${course.image || "../src/img/img1.png"}" alt="${course.title}">
        <h3>${course.title}</h3>
        <p>${course.level || "Beginner"}</p>
        <div class="details">
          <span class="rate"><i class="fa-solid fa-star"></i> ${(course.avg_rating || 0).toFixed(1)}</span>
          <span class="hrs">${course.hours} total hours</span>
          <span class="price">${course.price == 0 ? "Free" : course.price + " LE"}</span>
        </div>
      `;
      container.appendChild(card);
    });
  }

  document.getElementById("searchBtn").addEventListener("click", (e) => {
    e.preventDefault();
    const keyword = document.getElementById("searchInput").value.trim();
    if (keyword) {
      searchCourses(keyword);
    } else {
      fetchCourses(); // reload all courses if empty search
    }
  });

  fetchCourses();
</script>
</body>

</html>
